@model IEnumerable<form_1a.Models.form_2B>
@{
    ViewBag.Title = "Search Item";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 add-border" style="padding-bottom: 40px;">
            <div class="col-md-12">
                <p class="h3"><strong>Civil Registry Form No. 2A</strong></p>
                <p class="h4">(Death-not Available)</p>
            </div>
            <div class="col-md-12 form-group">
                <hr class="solid" />
            </div>
            <div class="col-sm-2">
                <label>Select Search By</label>
                <select class="form-control" id="selType">
                    <option value="name">Name of Deceased</option>
                    <option value="year">Records of Death for Year</option>
                </select>
            </div>
            <div class="col-sm-8">
                <label>Enter Search Item</label>
                <input type="text" class="form-control" placeholder="search item" id="searchItem" />
            </div>
            <div class="col-sm-2">
                <label>&nbsp;</label>
                <input type="button" class="form-control btn btn-primary" value="Search" id="btnSearch" />
            </div>
            <br />
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-12 add-border" style="padding-top: 25px;">
            <div class="col-md-12">
                <p class="h4" style="padding-bottom: 10px;"><strong>List of Records</strong></p>
            </div>
            <div id="divResult" class="col-lg-12">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Name of Deceased</th>
                            <th>Date of Death</th>
                            <th>Records of Death for Year</th>
                            <th>Date of Entry</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="bodyContents">
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.name</td>
                                <td>@Html.DisplayFor(modelItem => item.date_of_death)</td>
                                <td>@item.year</td>
                                <td>@Html.DisplayFor(modelItem => item.entry)</td>
                                <td>
                                    <input class="btn btn-primary" onclick="ViewPDF('@item.filename')" id="btnViewPDF" type="button" value="View PDF" />&nbsp;
                                    <input class="btn btn-primary" type="button" value="Edit" onclick="EditItem('@item.filename' )" />&nbsp;
                                    <input class="btn btn-primary" type="button" value="Copy" onclick="CopyRecords('@item.filename' )" />
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>




<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="http://www.datejs.com/build/date.js"></script>
<script type="text/javascript">
    $('#btnSearch').click(function () {

        var selType = $('#selType').val();          
        var searchItem = $('#searchItem').val();    
        var htmls = "";
        $('#bodyContents').html('');                

        if (searchItem != "") {
            $.ajax({
                url: '/Home/SearchThisForm2B',            
                type: 'get',
                data: { selType: selType, searchItem: searchItem }, 
                success: function (data) {
                    if (data != "0") {
                        $.each(data, function (a, b) {
                            htmls = '<tr><td>' + b.name + '</td><td>' + b.date_of_death + '</td><td>' + b.year + '</td><td>' + b.entry + '</td><td><input class="btn btn-primary" onclick="ViewPDF(\'' + b.filename + '\')" id="btnViewPDF" type="button" value="View PDF" />&nbsp;<input class="btn btn-primary" type="button" value="Edit"  onclick="EditItem(\'' + b.filename + '\')"  />&nbsp;<input class="btn btn-primary" type="button" value="Copy"  onclick="CopyRecords(\'' + b.filename + '\')"  /></td></tr>';
                            $('#bodyContents').append(htmls);
                        });

                    } else {
                        alert("No Records Found");
                        location.replace("/Home/SearchItemForm2B");
                    }

                }
            })
        } else {
            alert("Field Empty!");
            location.replace("/Home/SearchItemForm2B");

        }
    });

    function ViewPDF(filename) {
        var fname = pad(filename, 5);
        window.open("/OUTPUT_PDF/FORM_2B/" + fname + ".pdf"); 
    }

    function EditItem(filename) {
        location.replace("/Home/EditItemForm2B?filename=" + filename);
    }
    function CopyRecords(filename) {
        location.replace("/Home/CopyRecordsForm2B?filename=" + filename);
    }
    function Refresh() {
        location.replace("/Home/SearchItemForm2B");
    }
    function pad(str, max) {
        str = str.toString();
        return str.length < max ? pad("0" + str, max) : str;
    }
</script>
